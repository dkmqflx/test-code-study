## 3.3. 크로마틱(Chromatic)을 통한 UI 테스트 자동화

### 픽셀 단위 차이가 이만큼 존재합니다

- 가운데 이미지의 빨간점으로 표시된 부분이 두 이미지의 픽셀에서 서로 다른 부분

- 이렇게 알고리즘으로 픽셀까지 비교해보면 렌더링된 이미지가 분면 다른 것을 알 수 있다.

- 더 나아가 운영체제나 브라우저마다 각자 렌더링하는 방식이 다를 수 있는데

- 그렇다면 각 환경에서 렌더링된 이미지가 육안으로는 동일한 이미지로 보이지만 픽셀 단위로 비교해보면 다른 이미지로 판명될 수 있다

- 이런식으로 픽셀 단위를 기준으로 결과를 검증한다면 사실상 의미 있는 테스트라고 할 수 없고

- 운영체제나 브라우저 버전이 조금만 달라져도 모두 다른 이미지라고 판명될 가능성이 있고

- 스냅샷도 엄청나게 늘어나 사실상 관리하기가 불가능해질 것

<br/>

- 크로마틱 홈페이지에서 프로젝트를 등록하고

- 토큰을 통해 실행할 수 있도록 한다

- Get the Chromatic package

  ```shell

  npm install --save-dev chromatic

  ```

- Publish your Storybook

- On the command line, publish to Chromatic’s secure CDN for the first time with the following command:

  ```shell

  npx chromatic --project-token=chpt_4157ea395dcda12

  ```

- 위 명령어를 실행해서 배포 후, UI상 변경한 다음 다시 커밋을 한 다음 다시 배포 하면 변경사항이 생겼다고 경고 메세지를 보여준다

- 이 변경사항이 의도된 것이라면 Accept, 아니라면 Deny 버튼을 클릭하도록 한다

<br/>

## 3.5. 시각적 회귀 테스트의 한계

### 2. 이슈의 원인을 파악하는데 오랜 시간이 걸린다

- 특정 컴포넌트의 렌더링 결과를 스냅샷으로 찍어 비교하기 때문에 이슈의 원인이 무엇인지 정확히 알기 어려울 수도 있다.

- 예를들어 컴포넌트의 코드를 변경하지 않고 글로벌 CSS나 z-index의 상수 값 또는 외부 라이브러리의 레이아웃이 변경되어도 추운히 여러 컴포넌트의 렌더링 결과에 영향을 줄 수 있기 때문에 회귀 테스트의 스냅샷이 달라질 수 있다.

- 물론 이런 변경사항으로 인한 이슈를 감지할 수 있는 것이 시각적 회귀 테스트의 장점이기도 하지만 동시에 어떤 이슈로 스냅샷이 변경되었는지 원인을 찾기 어려운 경우도 있다.

### 피드백이 느림

- 이러한 이유로 시각적 회귀 테스트를 효과적으로 운영하기 위해서는 개발이 어느 정도 마무리된 시점에 CI와 연동하여 사용하는 것이 필수

- 예를들어 PR을 원격 저장소에 올렸을 때나 특정 브랜치에 머지 되었을 때 처럼 정말 필요한 경우에만 시각적 회귀 테스트가 실행되도록 해야 한다

- 이렇게 규칙을 세워 운영해야 불필요하게 커밋할 때마다 테스트 완료까지 기다리는 일이 없으며 비용 문제에서도 조금은 자유로워질 수 있다.
